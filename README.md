## Исходные данные:

**Требуется реализовать ansible скрипты для деплоя конфигурационных файлов nginx для серверов frontend. В качестве backend и storage серверов можно использовать nginx возвращающий статичный ответ.**
##Описание топологии и режимов работы
Имеем два Дата центра (DC1 и DC2)
В каждом из них стоит несколько frontend серверов, несколько backend серверов и несколько хранилищ storage.
Frontend серверы могут выполнять одну из или сразу обе функции: 
* проксировать трафик backend
* проксировать статику статику (storage) с кэшированием на 1 день.

Предельный размер кэша = размер диска (он один) – 50Гб
Серверы backend и storage – абсолютно одинаковые.
Трафик с frontend идет на backend и storage того же DC, если хотя бы один сервер из данного DC соответствующего типа отвечает. Иначе трафик должен идти на второй DC.

##Программное и аппаратное обеспечение
* PC (Windows 10 + WSL2)
* VirtualBOX (Далее VB) + Debian 10 Image (Делаем пакером образ Debian под VB и дальше его клонируем нужное количество раз)
* На каждой виртуальной машине установлен Nginx + Docker
* Контейнеры Doker для имитации хранилищ storage, и backend сервера. Созданы заранее, размещены на Докер Хабе (https://hub.docker.com/repository/docker/serg470/nginx_bs)
* Debian WSL2 Image
* Сетевое подключение VB в режиме Bridge, IP адреса из локальной сети по DHCP.



##Топология:
Фронтэнд серверами выступают сами виртуальные машины с nginx. Для имитации дополнительных серверов используются контейнеры докер на виртуальных хостах.
WSL2 Image с Debian используется как Remote host для запуска 

DC1
-------------------
VB     |   DOCKER
 ------|-----------
       |   BACK1
FRONT1 |   STORAGE1
FRONT2 |   BACK2
       |   STORAGE2
		   
DC2
-------------------
VB     |   DOCKER
 ------|-----------
       |   BACK1
FRONT3|   STORAGE1
FRONT4|   BACK2
       |   STORAGE2
	   
##Реализация
1. Установка необходимого софта (VB) с сайта https://www.virtualbox.org/
2. Установка WSL образа Debian через магазин приложений Микрософт.
3. Проверка версии WSL. В Powershall  выполняем `wsl -l -v`
4. Установка packer для Windows. Скачиваем https://www.packer.io/ и добавляем в переменную PATH путь до скачанного исполняемого файла.
5. Готовим шаблон для сборки образа. Пример:
```{
  "builders": [
  {
  "type": "virtualbox-iso",
  "guest_os_type": "Debian_64",
  "iso_url": "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-10.5.0-amd64-xfce-CD-1.iso",
  "iso_checksum": "md5:5edd897772a220f3d483823827b2cbdb",
  ...```
6. В VM добавлем нужное количество полученных образов с предустановленным nginx, docker, добавленным ssh ключем.
7. Далее используем Ансибл роль дял первичной подготовки хостов.

##Инструкция к роли Ansible
Роль Ансибл имеет две переменные в файле роли:
`setup` - Первичный запуск для подготовки тестовой среды, для запуска установить значение `first`
`backend_maintenance` - Режим работы фронэнд серверов. 
Значения: 
`none` - Все как обычно
`maintenance_dc1` - DC1 обслуживается
`maintenance_dc2` - DC2 обслуживается

##Что хотел бы еще сделать
Но больше времени на тестовое задание уже нет.
1. Оптимизировать конфиги.
2. Убрать генерирование конфигов локально
3. Оптимизировать развёртывание  среды для тестирования. Сделать через циклы.
4. Да и целом немного поменял бы структуру тасков.


